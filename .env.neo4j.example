# Neo4J Graph Traversal Configuration (Feature NEO4J-001)
# =============================================================================
# This file contains environment variables for Neo4J graph extraction and
# retrieval functionality for the UK Immigration RAG system.
#
# Usage:
# 1. Copy this file to .env.neo4j
# 2. Update the values below with your Neo4J credentials
# 3. Source the file: source .env.neo4j
# 4. Start the FastAPI application
#
# Documentation: See NEO4J_GRAPH_TRAVERSAL_SPEC.md for full specification
# =============================================================================

# ============================================================================
# Neo4J Connection Settings
# ============================================================================

# Neo4J server URI (Bolt protocol)
# Local development: bolt://localhost:7687
# Production: bolt://your-neo4j-server:7687
NEO4J_URI=bolt://localhost:7687

# Neo4J authentication
NEO4J_USER=neo4j
NEO4J_PASSWORD=your-secure-password-here

# Neo4J database name (default: neo4j)
NEO4J_DATABASE=neo4j

# ============================================================================
# Graph Extraction Settings
# ============================================================================

# Enable graph extraction feature
# Set to "true" to enable entity extraction and graph population
# Set to "false" to disable (graph endpoints will still be available if data exists)
GRAPH_EXTRACTION_ENABLED=true

# Batch size for writing entities/relationships to Neo4J
# Higher values = faster but more memory usage
# Recommended: 50-100 for production
GRAPH_EXTRACTION_BATCH_SIZE=50

# LLM model for entity extraction (via OpenRouter)
# Recommended: openai/gpt-4o-mini for cost-effectiveness
# Alternatives: anthropic/claude-3-haiku, meta-llama/llama-3.1-8b-instruct
GRAPH_EXTRACTION_LLM_MODEL=openai/gpt-4o-mini

# Enable LLM-based extraction for complex entities
# Set to "true" to extract requirements, conditions, and processes using LLM
# Set to "false" to use only SpaCy and regex (faster, cheaper, less accurate)
GRAPH_EXTRACTION_LLM_ENABLED=true

# ============================================================================
# Graph Retrieval Settings
# ============================================================================

# Enable graph retrieval in RAG pipeline
# Set to "true" to use graph traversal alongside vector/BM25 search
# Set to "false" to disable graph retrieval (vector + BM25 only)
GRAPH_RETRIEVAL_ENABLED=true

# Maximum graph traversal depth for multi-hop reasoning
# Higher values = more comprehensive but slower
# Recommended: 2-3 for production
GRAPH_MAX_HOP_DEPTH=3

# Number of documents to retrieve from graph traversal
# This is combined with vector/BM25 results
# Recommended: 10-20
GRAPH_RETRIEVAL_TOP_K=20

# Weight for graph retrieval in hybrid RAG pipeline
# Range: 0.0 to 1.0
# Example: 0.3 = 30% graph, 40% vector, 30% BM25
# Recommended: 0.2-0.4
GRAPH_WEIGHT_IN_HYBRID=0.3

# ============================================================================
# SpaCy Configuration
# ============================================================================

# SpaCy model for entity extraction
# Options: en_core_web_sm, en_core_web_md, en_core_web_lg
# Recommended: en_core_web_lg for best accuracy
SPACY_MODEL=en_core_web_lg

# ============================================================================
# OpenRouter API (Required for LLM Extraction)
# ============================================================================

# OpenRouter API key for LLM-based entity extraction
# Get your key at: https://openrouter.ai/keys
# Note: This should already be set in your main .env file
# OPENROUTER_API_KEY=sk-or-v1-...

# ============================================================================
# Feature Flags
# ============================================================================

# Enable graph explainability features
# Set to "true" to return graph traversal paths in API responses
# This helps users understand why specific documents were retrieved
GRAPH_EXPLAINABILITY_ENABLED=true

# ============================================================================
# Performance Tuning
# ============================================================================

# Neo4J connection pool size
# Higher values = better concurrency but more connections
# Recommended: 10-50 for production
NEO4J_MAX_CONNECTION_POOL_SIZE=50

# Neo4J connection timeout (seconds)
NEO4J_CONNECTION_TIMEOUT=30

# ============================================================================
# Monitoring and Logging
# ============================================================================

# Enable detailed graph extraction logging
# Set to "true" for debugging, "false" for production
GRAPH_EXTRACTION_DEBUG_LOGGING=false

# Log graph query performance metrics
# Set to "true" to log query execution times
GRAPH_QUERY_PERFORMANCE_LOGGING=true

# ============================================================================
# Cost Management
# ============================================================================

# Maximum LLM API calls per extraction job
# Used to prevent runaway costs
# Set to 0 for unlimited
GRAPH_EXTRACTION_MAX_LLM_CALLS=10000

# ============================================================================
# Deployment Notes
# ============================================================================
#
# Development Setup:
# 1. Start Neo4J using docker-compose-linkedin.yml:
#    docker-compose -f docker-compose-linkedin.yml up neo4j -d
# 2. Neo4J will be available at bolt://localhost:7687
# 3. Default credentials: neo4j/admin123 (change NEO4J_PASSWORD above)
#
# Production Setup:
# 1. Deploy Neo4J on DigitalOcean Droplet or managed service
# 2. Update NEO4J_URI with production server address
# 3. Use strong password (32+ characters, random)
# 4. Enable TLS: bolt+s://your-server:7687
# 5. Restrict network access to Neo4J port (7687) via firewall
# 6. Enable automated backups
#
# Security:
# - Never commit this file with real credentials
# - Rotate NEO4J_PASSWORD every 90 days
# - Use read-only user for retrieval in production
# - Enable audit logging for write operations
#
# =============================================================================
